{% extends 'home.html' %}
{% block title %}测试用例执行列表{% endblock %}
{% block content %}
                <div class="panel-body">
                    <table class="table table-hover">
                    <div class="col-md-offset-10">
                    </div>
                        <tr>
                            <th>ID</th>
                            <th>测试用例名称</th>
                            <th>请求返回报文</th>
                            <th>归属测试场景</th>
                        </tr>
                        {% for item in items %}
                        <tr>
                            <td><a href="#"><span class="badge">{{ loop.index }}</span></a></td>          <!--使用循环的数字作为id -->
                            <td>{{ item.name }}</td>
                            <td>
                                <samp id="response_{{ item.id }}"></samp>
                            </td>
                            <td>{{ item.scene_name }}</td>
                        </tr>
                        {% endfor %}

                    </table>
                    <div class="control-label col-md-4 col-md-offset-5" >
                        <input type="submit" class="btn btn-primary" value="开始" id="start_testcase">
                        <input type="submit" class="btn btn-primary" style="visibility: hidden;" value="测试">
                        <input type="submit" class="btn btn-default" disabled="disabled" value="生成测试报告" id="to_report">
                    </div>
                </div>
{% endblock %}
{% block css %}
    <style>
    .div-middle{
        display: table-cell;
        text-align: center;
        vertical-align: middle;
        width: 200px;
        height: 20px;
        margin: auto;
        background-color: #e7e7e7;
        border-radius: 20px;
        background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
        background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
        -webkit-background-size:20px 20px;background-size:20px 20px;
        -webkit-animation:progress-bar-stripes 5s linear infinite;
        -o-animation:progress-bar-stripes 5s linear infinite;
        animation:progress-bar-stripes 5s linear infinite;

    }
    @-webkit-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}
    @-o-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}
    @keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}
    </style>
{% endblock %}
{% block js %}
<script>
function ajax_post(start,len, ids) {
    $.ajax({
        beforeSend: function () {
            $('#response_'+ids[start]).html('<div class="col-md-10 col-md-offset-1" id="wait">' +
                '                                    <div class="div-middle" style=""><span style="font-size: 12px">请求中...</span></div>' +
                '                                </div>');
            $("#start_testcase").attr({disabled: "disabled"})
        },
        url:{{ url_for('test_case_request_blueprint.test_case_request_start') }},
        type: "POST",
        data: {'testcase_id': ids[start], 'test_case_time_id': testcase_time_id},
        success: function (response) {
            $('#response_'+ids[start]).html(response);

            start ++;
            if(start< len){
                ajax_post(start,len,ids)
            }
            else {
                $('#to_report').removeAttr("disabled")
            }
        },
        complete: function () {
            $("#start_testcase").removeAttr("disabled");
        },
        {#async: false,#}
    });
}
$(document).ready(function() {

    $("#start_testcase").click(function () {
        $('#to_report').attr("disabled",'disabled');
        $.ajax({
                url:{{ url_for('test_case_request_blueprint.test_case_time_get') }},
                type:"GET",
                async: false,
                success:function (response) {
                        testcase_time_id = JSON.parse(response)["testcase_time_id"];
                        scene_async = JSON.parse(response)["scene_async"];
                        testcase_time_id = eval(testcase_time_id);
                }
            });
        if(scene_async === '1'){
            let scene_case_list = {{ scene_case_list }};
            for(let i=0;i<scene_case_list.length;i++){
                let len = scene_case_list[i].length;
                ajax_post(0, len, scene_case_list[i]);
            }
        }else {
            let testcase_ids = {{ testcase_ids }};
            console.log(testcase_ids);
            let len = testcase_ids.length;
            ajax_post(0, len, testcase_ids)
        }
    });
    $("#to_report").click(function(){
        $.ajax({
            url:"{{ url_for("testcase_report_blueprint.testcase_report")}}?testcase_time_id=" + testcase_time_id,
            type:"POST",
            beforeSend:function(){
                $('#ajax_content').load("{{ url_for('home_blueprint.wait_time') }}");
            },
            success:function () {
                window.location.href = "{{ url_for("testcase_report_blueprint.testcase_report")}}?testcase_time_id=" + testcase_time_id
            }

        });

    });
    });
</script>
{% endblock %}