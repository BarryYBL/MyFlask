{% extends 'home.html' %}
{% block title %}编辑mysql数据库配置{% endblock %}
{% block content %}
            <div class="panel-body content-agileits" >
                <form action="{{ url_for('mysql_blueprint.mysql_update',mysql_id=mysql.id) }}" id="mysql_update_form" method="post" data-toggle="validator" class="form-horizontal">
                    {{ macro.form_group(lable_name="name",blank_name="配置名称(必填)",value=mysql.name) }}
                    {{ macro.form_group(lable_name="ip",blank_name="服务器地址(必填)",value=mysql.ip) }}
                    {{ macro.form_group(lable_name="port",blank_name="服务器端口(必填)",value=mysql.port) }}
                    {{ macro.form_group(lable_name="user",blank_name="服务器用户(必填)",value=mysql.user) }}
                    {{ macro.form_group(lable_name="password",blank_name="服务器密码(必填)",value=mysql.password) }}
                    {{ macro.form_group(lable_name="db_name",blank_name="数据库名",value=mysql.db_name) }}
                    {{ macro.form_group(lable_name="description",blank_name="配置备注",value=mysql.description) }}
                    {{ macro.submit(submit_id="mysql_update",test_style="",test_type="button",test_id="mysql_test") }}
                </form>
            </div>
{% endblock %}
{% block js %}
    <script>
        $(document).ready(function () {
            var validate = function () {
                   mysql_id = {{ mysql.id }}
                    $('#mysql_update_form').validate({
                        rules: {
                            name: {required: true, minlength:2,  maxlength:50, remote: {
                                    url: '/mysql_name_update_validate/',
                                    data:{
                                        "mysql_id": mysql_id
                                    }
                                }},
                            ip: {required: true},
                            port: {required: true},
                            user: {required: true},
                            password: {required: true},
                        },
                        messages: {
                           name: {required: '不可为空', minlength:'长度最少2位',  maxlength:'不可超过50位', remote: '已存在名称'},
                            ip: {required: '不可为空'},
                            port: {required: '不可为空'},
                            user: {required: '不可为空'},
                            password: {required: '不可为空'},
                        }
                    })
                };
            $('input').bind('input propertychange', function() {
                validate()
                });
            $('#mysql_update').click(function () {
                $('#mysql_update_form').validate({
                          rules: {
                           name: {required: true, minlength:2,  maxlength:50, remote: {
                                url: '/mysql_name_update_validate/',
                                data:{
                                    "mysql_id": mysql_id
                                }
                            }},
                            ip: {required: true},
                            port: {required: true},
                            user: {required: true},
                            password: {required: true},
                        },
                        messages: {
                           name: {required: '不可为空', minlength:'长度最少2位',  maxlength:'不可超过50位', remote: '已存在名称'},
                            ip: {required: '不可为空'},
                            port: {required: '不可为空'},
                            user: {required: '不可为空'},
                            password: {required: '不可为空'},
                        },
                        submitHandler: function (form) {
                        form.submit()
                    }
                    });
            });
            $('#mysql_test').click(function () {
                $.ajax({
                    url:'{{ url_for("mysql_blueprint.mysql_test") }}',
                    type:'POST',
                    data:$('#mysql_update_form').serialize(),
                    success:function (response) {
                        {#let result = JSON.parse(response);#}
                        $('#request_body_show').html(response)
                    }
                })
            })
});

    </script>
{% endblock %}